<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Verification Successful | Bulktrader</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Great+Vibes&family=Roboto:wght@400;500;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <style>
        :root { --primary-gold: #c5a059; --terminal-bg: rgba(10, 10, 10, 0.95); }
        body {
            margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; background-color: #000; color: white; font-family: 'Roboto', sans-serif;
            overflow-x: hidden; justify-content: center;
        }

        .page-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('card-view-bg.jpg'); 
            background-size: cover; background-position: center;
            z-index: -1; filter: brightness(0.4);
        }

        .system-logs {
            position: absolute; top: 20px; left: 20px; font-family: 'Share Tech Mono';
            font-size: 10px; color: var(--primary-gold); opacity: 0.6; pointer-events: none;
        }

        .header-area { text-align: center; margin-bottom: 20px; animation: fadeIn 1s ease; }
        .status-tag { 
            background: rgba(0, 255, 100, 0.1); border: 1px solid #00ff64;
            color: #00ff64; padding: 5px 15px; border-radius: 20px;
            font-size: 10px; font-weight: bold; letter-spacing: 2px;
        }

        .card-perspective { perspective: 1200px; width: 100%; display: flex; justify-content: center; padding: 20px 0; }
        .card-wrapper {
            position: relative; width: 600px; height: 377px; border-radius: 18px;
            overflow: hidden; box-shadow: 0 40px 80px rgba(0,0,0,1);
            background-color: #000; transform-style: preserve-3d; transition: transform 0.1s ease-out;
        }

        @media (max-width: 650px) { .card-wrapper { transform: scale(0.8); } }
        @media (max-width: 500px) { .card-wrapper { transform: scale(0.55); margin: -40px 0; } }

        .card-bg { width: 100%; height: 100%; object-fit: cover; position: absolute; z-index: 1; pointer-events: none;}
        .card-content {
            position: absolute; z-index: 2; top: 110px; left: 0;
            width: 100%; height: calc(100% - 110px); display: flex; padding: 10px 45px; box-sizing: border-box;
        }

        .photo-area { width: 140px; }
        .avatar-frame { width: 130px; height: 155px; border: 1px solid rgba(197, 160, 89, 0.4); overflow: hidden; background: #111; }
        .avatar-frame img { width: 100%; height: 100%; object-fit: cover; }
        .details-area { flex: 1; padding-left: 25px; color: var(--primary-gold); font-family: 'Cinzel', serif; }
        .row { display: flex; gap: 20px; margin-bottom: 12px; }
        .value { font-size: 13px; font-weight: 700; text-shadow: 1px 1px 2px #000; }
        .label { font-size: 8px; text-transform: uppercase; color: #fff; opacity: 0.5; font-family: 'Roboto'; }

        .bottom-right-container { position: absolute; bottom: 25px; right: 45px; display: flex; align-items: flex-end; gap: 15px; z-index: 5; }
        .cursive-sig { font-family: 'Great Vibes', cursive; font-size: 32px; color: var(--primary-gold); margin-bottom: 5px; }
        #qrcode { padding: 4px; background: white; width: 50px; height: 50px; border-radius: 4px; }

        .action-bar { display: flex; gap: 15px; margin-top: 20px; z-index: 100; }
        .btn {
            padding: 15px 25px; border: 1px solid var(--primary-gold); border-radius: 4px;
            font-family: 'Cinzel'; background: transparent; color: var(--primary-gold);
            cursor: pointer; transition: 0.3s; font-weight: bold; text-transform: uppercase; font-size: 12px;
        }
        .btn:hover { background: var(--primary-gold); color: black; box-shadow: 0 0 15px var(--primary-gold); }
        .btn-back { border-color: #555; color: #aaa; }

        .card-scanner {
            position: absolute; top: 0; left: 0; width: 100%; height: 3px;
            background: var(--primary-gold); box-shadow: 0 0 15px var(--primary-gold);
            animation: scanMove 3s infinite linear; z-index: 10; opacity: 0.4;
        }

        /* Toast Notification */
        #toast {
            position: fixed; bottom: 20px; background: var(--primary-gold); color: black;
            padding: 10px 20px; border-radius: 5px; font-family: 'Share Tech Mono';
            font-weight: bold; display: none; animation: fadeIn 0.3s; z-index: 1000;
        }

        @keyframes scanMove { 0% { top: 0; } 100% { top: 100%; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div id="toast">SYSTEM: FILE DOWNLOADED</div>
    <div class="page-bg"></div>
    
    <div class="system-logs">
        DECRYPTING SESSION... OK<br>
        VERIFYING BIOMETRICS... OK<br>
        ACCESS GRANTED: LEVEL 4<br>
        ENCRYPTING EXPORT...
    </div>

    <div class="header-area">
        <span class="status-tag">ACCESS GRANTED</span>
        <h1 style="font-family: 'Cinzel'; color: var(--primary-gold); margin-top: 10px; font-size: 1.2rem; letter-spacing: 2px;">IDENTITY VERIFIED</h1>
    </div>

    <div class="card-perspective">
        <div class="card-wrapper" id="idCard">
            <div class="card-scanner"></div>
            <img src="background.png" class="card-bg">
            <div class="card-content">
                <div class="photo-area">
                    <div class="avatar-frame"><img id="cardAvatar"></div>
                    <div class="field" style="margin-top: 15px;"><div class="label">Serial</div><div class="value" id="cardNum" style="font-size: 10px;"></div></div>
                </div>
                <div class="details-area">
                    <div class="row"><div class="field"><div class="label">Identification</div><div class="value" id="cardName" style="font-size: 16px;"></div></div></div>
                    <div class="row">
                        <div class="field"><div class="label">Registry</div><div class="value" id="cardNat"></div></div>
                        <div class="field"><div class="label">Location</div><div class="value" id="cardLocation"></div></div>
                    </div>
                    <div class="row">
                        <div class="field"><div class="label">Class</div><div class="value" id="cardSex"></div></div>
                        <div class="field"><div class="label">Origin</div><div class="value" id="cardDob"></div></div>
                    </div>
                    <div class="row"><div class="field"><div class="label">Terminal Issue Date</div><div class="value" id="cardIssue"></div></div></div>
                </div>
            </div>
            <div class="bottom-right-container">
                <div class="signature-section"><div class="cursive-sig" id="cardSig"></div><div class="sig-line" style="border-top:1px solid var(--primary-gold)"></div><div class="sig-label" style="font-size:7px; text-align:center; opacity:0.5;">Authorized Access</div></div>
                <div id="qrcode"></div>
            </div>
        </div>
    </div>

    <div class="action-bar">
        <button class="btn btn-back" onclick="location.href='index.html'">New</button>
        <button class="btn" onclick="downloadCard()">Export</button>
        <button class="btn" onclick="shareToX()">Broadcast</button>
    </div>

    <script>
        const data = JSON.parse(localStorage.getItem('bt_card_data'));
        if(!data) window.location.href = 'index.html';

        document.getElementById('cardName').innerText = "@" + data.handle.toUpperCase();
        document.getElementById('cardNat').innerText = data.nat.toUpperCase();
        document.getElementById('cardLocation').innerText = data.loc.toUpperCase();
        document.getElementById('cardSex').innerText = data.sex;
        document.getElementById('cardDob').innerText = data.dob ? new Date(data.dob).toLocaleDateString('en-GB') : "--/--/----";
        document.getElementById('cardIssue').innerText = data.issue;
        document.getElementById('cardNum').innerText = data.serial;
        document.getElementById('cardSig').innerText = data.handle;
        
        let qrcode = new QRCode(document.getElementById("qrcode"), { 
            text: `https://x.com/${data.handle}`, 
            width: 50, height: 50, 
            colorDark : "#c5a059",
            colorLight: "#ffffff"
        });
        
        const avatar = document.getElementById('cardAvatar');
        avatar.crossOrigin = "anonymous";
        avatar.src = `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(`https://unavatar.io/x/${data.handle}`)}`;

        const card = document.getElementById('idCard');
        document.addEventListener('mousemove', (e) => {
            const x = (window.innerWidth / 2 - e.pageX) / 25;
            const y = (window.innerHeight / 2 - e.pageY) / 25;
            card.style.transform = `rotateY(${-x}deg) rotateX(${y}deg)`;
        });

        if (window.DeviceOrientationEvent) {
            window.addEventListener('deviceorientation', (e) => {
                if(e.gamma) card.style.transform = `rotateY(${e.gamma / 2}deg) rotateX(${(e.beta - 45) / 2}deg)`;
            });
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg; t.style.display = 'block';
            setTimeout(() => { t.style.display = 'none'; }, 3000);
        }

        async function downloadCard() {
            const canvas = await html2canvas(card, { useCORS: true, scale: 3, backgroundColor: null });
            const link = document.createElement('a');
            link.download = `BT_Access_${data.handle}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
            showToast("SYSTEM: CARD EXPORTED");
        }

        async function shareToX() {
            const canvas = await html2canvas(card, { useCORS: true, scale: 2 });
            const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
            const file = new File([blob], 'Bulktrader_Access_Card.png', { type: 'image/png' });

            const shareUrl = 'https://chidimm06.github.io/bulktradeaccesscard/';
            const tweetText = `My Bulktrader Access Card is finally here! ðŸš€ Proud to be part of the community. \n\nCreate yours here: ${shareUrl} \n\n#Bulktrader #BTC #Crypto`;

            // MOBILE/NATIVE SHARE (This shows image in X post)
            if (navigator.canShare && navigator.canShare({ files: [file] })) {
                try {
                    await navigator.share({
                        files: [file],
                        title: 'Bulktrader Access Card',
                        text: tweetText
                    });
                } catch (err) {
                    // Fallback to link if cancelled
                    window.open(`https://x.com/intent/tweet?text=${encodeURIComponent(tweetText)}`, '_blank');
                }
            } else {
                // DESKTOP FALLBACK (Requires user to attach downloaded image)
                downloadCard();
                setTimeout(() => {
                    alert("Card downloaded! Attach it to your tweet to show it off.");
                    window.open(`https://x.com/intent/tweet?text=${encodeURIComponent(tweetText)}`, '_blank');
                }, 1000);
            }
        }
    </script>
</body>
</html>
